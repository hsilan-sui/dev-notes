---
title: "W1-2:系統管理層-排程與背景任務(anacron)"
sidebar_position: 2
---


## 一、anacron在做什麼（What）

**anacron** 是一個和 CRON 很像、但設計給「**不會 24 小時開機的電腦**」使用的排程工具。

一句話對照：

> **CRON 給伺服器用**
> **anacron 給桌機、筆電用**

核心差異只有一個重點：
👉 **錯過時間，會不會補跑**

---

### 二、為什麼需要 anacron（Why）

先用一個實際情境來理解：

* 你設定一個 **每天晚上 10 點的備份**
* 用 CRON：

  * 10 點電腦沒開 → **這次備份直接消失**
  * 直到下一個排程時間才會再跑
* 用 anacron：

  * 10 點沒開沒關係
  * 👉 **下次開機時一定會補跑一次**

所以結論是：

| 情境          | 工具      |
| ----------- | ------- |
| 伺服器、24 小時開機 | CRON    |
| 筆電、桌機、會關機   | anacron |

---

### 三、anacron 的運作方式（How）

#### 1️⃣ anacron 的特性

* 不像 CRON 是 daemon
* anacron 是一個「**被執行的指令**」
* 系統每次開機時會自動執行 anacron
* 任務：

  * **一定會執行**
  * 但不保證精準時間點

⚠️ 限制：

* **只能用「天」當單位**
* 不能用分鐘、秒

---

#### 2️⃣ 權限與使用者

* anacron **只由 root 使用**
* 所有 anacron 任務：

  * 都是 **root 權限**
* 適合：

  * 系統層級維護
  * 備份
  * 清理任務

---

### 四、anacron 設定檔

#### 位置

* 設定檔在：

```
/etc/anacrontab
```

必須用 root 編輯。

---

#### 內建任務（實際上是接 CRON）

你會看到類似這些設定：

* 每天
* 每週
* 每月

這些其實是用 `run-parts` 這個指令：

> run-parts：
> **執行某個目錄底下所有可執行檔案**

例如：

* 指定某個目錄
* 裡面的 script 全部照週期跑

---

### 五、anacron job 的格式（重點）

每一行代表一個任務，共 **四個欄位**：

```
週期 天數 延遲 分鐘 任務名稱 指令
```

逐欄說明：

#### 1️⃣ 週期（天）

* 用數字：

  * 1 → 每天
  * 7 → 每 7 天
* 或用文字：

  * @daily
  * @weekly
  * @monthly

---

#### 2️⃣ 延遲（分鐘）

* anacron 啟動後，**延多久才跑**
* 用來避免：

  * 一開機就同時跑一堆任務
  * 系統負載暴增

---

#### 3️⃣ 任務名稱（Job ID）

* 必須唯一
* anacron 會用這個名字：

  * 建立一個「時間戳檔案」
  * 記錄上次執行時間

時間戳檔案位置：

```
/var/spool/anacron
```

---

#### 4️⃣ 指令

* 要執行的指令或腳本
* 建議使用 **絕對路徑**

---

### 六、實作範例（老師示範）

#### 需求

* 每 2 天跑一次
* 開機後延遲 1 分鐘
* 驗證是否真的有執行

#### 任務設定概念（中文）

* 週期：每 2 天
* 延遲：1 分鐘
* 任務名稱：backup
* 指令：把目前時間寫入暫存檔

---

#### 驗證方式

1. 用 root 編輯 `/etc/anacrontab`
2. 新增一行任務
3. 儲存後執行：

```
anacron -T
```

用途：

* 檢查語法
* 前景執行（方便測試）

---

#### 執行後你會看到

* `/var/spool/anacron/backup` 檔案被建立
* 檔案內只有一行：

  * 上次執行時間

anacron 就是靠這個時間，判斷：

* 要不要補跑
* 什麼時候該再跑

---

#### 再次執行 anacron

* 如果時間還沒到
* 會顯示：

  * 沒有任務需要執行

---

### 七、CRON vs anacron 核心理解（超重要）

| 比較項目    | CRON   | anacron          |
| ------- | ------ | ---------------- |
| 是否補跑    | ❌ 不會   | ✅ 會              |
| 時間單位    | 分鐘     | 天                |
| 是否需持續開機 | 是      | 否                |
| 使用者     | 每個使用者  | 只有 root          |
| 適合情境    | Server | Desktop / Laptop |

---

### 八、你的情境對應（重點）

對你來說，這一堂最重要的理解是：

* **CRON**
  用在：

  * 伺服器
  * Worker
  * 長時間跑的後端服務

* **anacron**
  用在：

  * 筆電上的自動備份
  * 每天更新一次資料
  * 開機後補跑的任務

👉 之後你在寫專案說明時，可以清楚說：

> 「在不保證 24 小時開機的環境中，
> 使用 anacron 確保週期性任務一定會執行。」

這一句**很工程師**。

---

### 九、一句話總結（你可以直接寫進筆記）

> CRON 解決「準時跑」，
> anacron 解決「一定跑」。

