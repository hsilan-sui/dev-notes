---
title: "ã€API_ kataã€‘3.DELETE & PATCH"
sidebar_position: 3
---

## ğŸŸ§ é–‹å ´ç™½



## ğŸŸ¦ åˆªé™¤æ‰€æœ‰ä»£è¾¦ API

```js
const http = require("http");
const { v4: uuidv4 } = require('uuid'); //æ–°å¢æ¨¡çµ„
const todos = [ //è³‡æ–™åº«
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦é¢è©¦"
  },
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦åƒæ™šé¤"
  }
];


let body = '';

req.on('data', (chunk) => {
    console.log(chunk);//å¯ä»¥è¼¸å‡ºchunkçœ‹çœ‹
    body += chunk;
  });

const requestListener = (req, res) => {

  const headers = {
   'Access-Control-Allow-Headers': 'Content-Type, Authorization, Content-Length, X-Requested-With',
   'Access-Control-Allow-Origin': '*',
   'Access-Control-Allow-Methods': 'PATCH, POST, GET,OPTIONS,DELETE',
    'Content-Type': 'application/json' 
}

  
  if(req.url == "/todos" && req.method == "GET") { //GETè«‹æ±‚
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
      "status": "success",
      "data": todos,
    })); 
    res.end(); 

  } else if (req.url == "/todos" && req.method == "POST"){ 
    req.on('end', () => {
      try { //æˆåŠŸå¯«å…¥
            //æˆ‘æ”¶åˆ°çš„æ˜¯å­—ä¸²å°åŒ… æ‰€ä»¥è¦è½‰æˆç‰©ä»¶æ ¼å¼ æ‰èƒ½å–å‡ºkey value
          const title = JSON.parse(body).title;
          if(title !== undefined) {
            //å°±æŠŠè³‡æ–™å¯«å…¥
              const todo = {
                "title": title,
                "id": uuidv4()
              }
              console.log(todo);
              todos.push(todo);
              res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "success",
                "data": todos,
              })); 
              res.end();
          } else { //titleä¸å­˜åœ¨ç„¡å€¼çš„è©±
            res.writeHead(400, headers); // å¤±æ•— å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "false",
                "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
              })); 
              res.end();
          }

      } catch(error) {
        res.writeHead(400, headers); 
          res.write(JSON.stringigy({
            "status": "false",
            "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
          })); 
        
        res.end();
      }});
      
    
  } else if (req.url == "/todos" && req.method == "DELETE") {//åˆªé™¤æ‰€æœ‰ä»£è¾¦
    todos.length = 0; //æ¸…ç©ºæ‰€æœ‰ä»£è¾¦
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
        "status": "success",
        "data": todos, //[]
    })); 
    res.end();
  } else if (req.method == "OPTIONS"){
    res.writeHead(200, headers); 
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  } else { //ä¸æ˜¯é¦–é  å°±å°å‡º404å›æ‡‰
    res.writeHead(404, headers); // 404 å›æ‡‰ header
    res.write(JSON.stringify({ //æ”¹å¯«JSONå…§å®¹ 404
      "status": "false",
      "message": "ç„¡æ­¤ç¶²ç«™è·¯ç”±",
    })); // å›æ‡‰å…§å®¹
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  }
  
};

// å»ºç«‹ server
const server = http.createServer(requestListener);//ä½¿ç”¨è€…é€²å…¥ç¶²å€å°±è§¸ç™¼è«‹æ±‚
server.listen(3005);

```

### 0ï¸âƒ£ é™£åˆ—èˆ‡å­—ä¸²è™•ç†æ“ä½œï¼šstartsWithã€popã€findIndex

- ![delete](/img/delete_01.png)
- ![delete](/img/delete_02.png)
- ![delete](/img/delete_03.png)

### 1ï¸âƒ£ åˆªé™¤å–®ç­†ä»£è¾¦ API



```js
const http = require("http");
const { v4: uuidv4 } = require('uuid'); //æ–°å¢æ¨¡çµ„
const todos = [ //è³‡æ–™åº«
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦é¢è©¦"
  },
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦åƒæ™šé¤"
  }
];


let body = '';

req.on('data', (chunk) => {
    console.log(chunk);//å¯ä»¥è¼¸å‡ºchunkçœ‹çœ‹
    body += chunk;
  });

const requestListener = (req, res) => {

  const headers = {
   'Access-Control-Allow-Headers': 'Content-Type, Authorization, Content-Length, X-Requested-With',
   'Access-Control-Allow-Origin': '*',
   'Access-Control-Allow-Methods': 'PATCH, POST, GET,OPTIONS,DELETE',
    'Content-Type': 'application/json' 
}

  
  if(req.url == "/todos" && req.method == "GET") { //GETè«‹æ±‚
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
      "status": "success",
      "data": todos,
    })); 
    res.end(); 

  } else if (req.url == "/todos" && req.method == "POST"){ 
    req.on('end', () => {
      try { //æˆåŠŸå¯«å…¥
            //æˆ‘æ”¶åˆ°çš„æ˜¯å­—ä¸²å°åŒ… æ‰€ä»¥è¦è½‰æˆç‰©ä»¶æ ¼å¼ æ‰èƒ½å–å‡ºkey value
          const title = JSON.parse(body).title;
          if(title !== undefined) {
            //å°±æŠŠè³‡æ–™å¯«å…¥
              const todo = {
                "title": title,
                "id": uuidv4()
              }
              console.log(todo);
              todos.push(todo);
              res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "success",
                "data": todos,
              })); 
              res.end();
          } else { //titleä¸å­˜åœ¨ç„¡å€¼çš„è©±
            res.writeHead(400, headers); // å¤±æ•— å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "false",
                "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
              })); 
              res.end();
          }

      } catch(error) {
        res.writeHead(400, headers); 
          res.write(JSON.stringigy({
            "status": "false",
            "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
          })); 
        
        res.end();
      }});
      
    
  } else if (req.url == "/todos" && req.method == "DELETE") {//åˆªé™¤æ‰€æœ‰ä»£è¾¦
    todos.length = 0; //æ¸…ç©ºæ‰€æœ‰ä»£è¾¦
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
        "status": "success",
        "data": todos, //[]
    })); 
    res.end();
  } else if (req.url.startWith("/todos/") && req.method == "DELETE") {//åˆªé™¤å–®ç­†ä»£è¾¦
    const id = req.url.split("/").pop();//å–å¾—DELETEè«‹æ±‚çš„ç¶²å€æœ€å¾Œçš„uuid
    const index = todos.findIndex(el => el.id === id)//æ¯”å°å‰›å‰›çš„è«‹æ±‚ç¶²å€id åœ¨è³‡æ–™è¡¨ä¸­æ˜¯å¦å­˜åœ¨é€™å€‹idä¸¦å›å‚³index
    //å¦‚æœè©²idæ¯”å°å­˜åœ¨
    if(index !== -1) {
            res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
            res.write(JSON.stringigy({
            "status": "success",
            "data": todos, //[]
        })); 
        res.end();
    } else {
        res.writeHead(400, headers); 
          res.write(JSON.stringigy({
            "status": "false",
            "message": "ç„¡æ­¤todo id",
          })); 
        
        res.end();
    };
    
  } else if (req.method == "OPTIONS"){
    res.writeHead(200, headers); 
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  } else { //ä¸æ˜¯é¦–é  å°±å°å‡º404å›æ‡‰
    res.writeHead(404, headers); // 404 å›æ‡‰ header
    res.write(JSON.stringify({ //æ”¹å¯«JSONå…§å®¹ 404
      "status": "false",
      "message": "ç„¡æ­¤ç¶²ç«™è·¯ç”±",
    })); // å›æ‡‰å…§å®¹
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  }
  
};

// å»ºç«‹ server
const server = http.createServer(requestListener);//ä½¿ç”¨è€…é€²å…¥ç¶²å€å°±è§¸ç™¼è«‹æ±‚
server.listen(3005);

```

---

### 2ï¸âƒ£ å¯¦ä½œï¼šç·¨è¼¯å–®ç­†ä»£è¾¦ API 

- ![patch](/img/patch_01.png)

```js
const http = require("http");
const { v4: uuidv4 } = require('uuid'); //æ–°å¢æ¨¡çµ„
const todos = [ //è³‡æ–™åº«
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦é¢è©¦"
  },
  {
    id: uuid4(),
    title: "ä»Šå¤©è¦åƒæ™šé¤"
  }
];


let body = '';

req.on('data', (chunk) => {
    console.log(chunk);
    body += chunk;
  });

const requestListener = (req, res) => {

  const headers = {
   'Access-Control-Allow-Headers': 'Content-Type, Authorization, Content-Length, X-Requested-With',
   'Access-Control-Allow-Origin': '*',
   'Access-Control-Allow-Methods': 'PATCH, POST, GET,OPTIONS,DELETE',
    'Content-Type': 'application/json' 
}

  
  if(req.url == "/todos" && req.method == "GET") { //GETè«‹æ±‚
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
      "status": "success",
      "data": todos,
    })); 
    res.end(); 

  } else if (req.url == "/todos" && req.method == "POST"){ 
    req.on('end', () => {
      try { //æˆåŠŸå¯«å…¥
            //æˆ‘æ”¶åˆ°çš„æ˜¯å­—ä¸²å°åŒ… æ‰€ä»¥è¦è½‰æˆç‰©ä»¶æ ¼å¼ æ‰èƒ½å–å‡ºkey value
          const title = JSON.parse(body).title;
          if(title !== undefined) {
            //å°±æŠŠè³‡æ–™å¯«å…¥
              const todo = {
                "title": title,
                "id": uuidv4()
              }
              console.log(todo);
              todos.push(todo);
              res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "success",
                "data": todos,
              })); 
              res.end();
          } else { //titleä¸å­˜åœ¨ç„¡å€¼çš„è©±
            res.writeHead(400, headers); // å¤±æ•— å›æ‡‰ header
              res.write(JSON.stringigy({
                "status": "false",
                "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
              })); 
              res.end();
          }

      } catch(error) {
        res.writeHead(400, headers); 
          res.write(JSON.stringigy({
            "status": "false",
            "message": "æ¬„ä½æœªå¡«å¯«æ­£ç¢ºï¼Œç„¡æ­¤todo id",
          })); 
        
        res.end();
      }});
      
    
  } else if (req.url == "/todos" && req.method == "DELETE") {//åˆªé™¤æ‰€æœ‰ä»£è¾¦
    todos.length = 0; //æ¸…ç©ºæ‰€æœ‰ä»£è¾¦
    res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
    res.write(JSON.stringigy({
        "status": "success",
        "data": todos, //[]
    })); 
    res.end();
  } else if (req.url.startWith("/todos/") && req.method == "DELETE") {//åˆªé™¤å–®ç­†ä»£è¾¦
    const id = req.url.split("/").pop();//å–å¾—DELETEè«‹æ±‚çš„ç¶²å€æœ€å¾Œçš„uuid
    const index = todos.findIndex(el => el.id === id)//æ¯”å°å‰›å‰›çš„è«‹æ±‚ç¶²å€id åœ¨è³‡æ–™è¡¨ä¸­æ˜¯å¦å­˜åœ¨é€™å€‹idä¸¦å›å‚³index
    //å¦‚æœè©²idæ¯”å°å­˜åœ¨
    if(index !== -1) {
            res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
            res.write(JSON.stringigy({
            "status": "success",
            "data": todos, //[]
        })); 
        res.end();
    } else {
        res.writeHead(400, headers); 
          res.write(JSON.stringigy({
            "status": "false",
            "message": "ç„¡æ­¤todo id",
          })); 
        
        res.end();
    };
    
  } else if (req.url.startWith("/todos/") && req.method == "PATCH") {
    req.on("end",() => {
        try {
            //è§£æå°åŒ…çš„å­—ä¸²è³‡æ–™ç‚ºJSONç‰©ä»¶
            const todo = JSON.parse(body).title;
            //æˆ‘è¦çŸ¥é“è¦ä¿®æ”¹å“ªä¸€ç­†uuidçš„è³‡æ–™
            const id = req.url.split("/").pop()
            //è³‡æ–™åº«æ˜¯å¦æœ‰é€™ç­†index
            const index = todos.findIndex(element => element.id === id)
            //  æ’éŒ¯
            if(todo !== undefined && index !== -1) {
                todos[index].title = todo
                res.writeHead(200, headers); // æˆåŠŸ å›æ‡‰ header
                res.write(JSON.stringigy({
                    "status": "success",
                    "data": todos, 
                })); 
                res.end();
            }
        } catch(error) {
            res.writeHead(400, headers); 
            res.write(JSON.stringigy({
                "status": "false",
                "message": "ç„¡æ­¤todo id",
            })); 
        
            res.end();
        }
    })
  }else if (req.method == "OPTIONS"){
    res.writeHead(200, headers); 
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  } else { //ä¸æ˜¯é¦–é  å°±å°å‡º404å›æ‡‰
    res.writeHead(404, headers); // 404 å›æ‡‰ header
    res.write(JSON.stringify({ //æ”¹å¯«JSONå…§å®¹ 404
      "status": "false",
      "message": "ç„¡æ­¤ç¶²ç«™è·¯ç”±",
    })); // å›æ‡‰å…§å®¹
    res.end(); // çµæŸä¸¦é€å‡ºå›æ‡‰
  }
  
};

// å»ºç«‹ server
const server = http.createServer(requestListener);//ä½¿ç”¨è€…é€²å…¥ç¶²å€å°±è§¸ç™¼è«‹æ±‚
server.listen(3005);

```

